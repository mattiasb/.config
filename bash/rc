# -*- mode: sh -*-

# Source global definitions
if [ -f /etc/bashrc ]; then
    . /etc/bashrc
fi

# Source any potential machine local scripts
if [ -f "${HOME}/.config/bash/rc.local" ]; then
    # shellcheck source=/dev/null
    . "${HOME}/.config/bash/rc.local"
fi

### Environment
for file in "${HOME}/.config/environment.d/"*.conf; do
    while IFS= read -r line
    do
        if [[ ! "$line" =~ ^[[:space:]]*# ]]; then
            eval "export ${line}" &>/dev/null
        fi
    done < "${file}"
done

## Set up PS1
case "${TERM}+powerline=$(systemctl is-active --user powerline.service)" in
    *-256color+powerline=active)    . /usr/share/powerline/bash/powerline.sh ;;
   eat-truecolor+powerline=active) . /usr/share/powerline/bash/powerline.sh ;;
   *)
       # shellcheck source=/home/mattiasb/.config/bash/old-prompt.sh
       . ~/.config/bash/old-prompt.sh ;;
esac

### Configuration

# History
shopt -s histappend

# Disable C-s / C-q for XOFF/XON
stty start undef
stty stop undef

### Completion
for comp in "${HOME}/.config/bash_completion.d/"*; do
    if [ -f "${comp}" ] ; then
        # shellcheck source=/dev/null
        . "${comp}"
    fi
done

# shellcheck source=./aliases
. "${HOME}/.config/bash/aliases"
for a in $(alias | cut -d "=" -f 1 | cut -d " " -f 2); do
    complete -F _complete_alias "$a"
done

# shellcheck source=./functions
. "${HOME}/.config/bash/functions"

if [ -f "${HOME}/.config/bash/functions.work" ]; then
    # shellcheck source=/dev/null
    . "${HOME}/.config/bash/functions.work"
fi

# Use fzf
. /usr/share/fzf/shell/key-bindings.bash
# Take back M-c from fzf
bind '"\ec":capitalize-word'
